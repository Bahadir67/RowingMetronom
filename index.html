<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rowing Metronome</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        h1 {
            color: #2c3e50;
        }
        .form-group {
            margin: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
        #phaseDetails {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Rowing Metronome</h1>
    <div id="settings">
        <div class="form-group">
            <label>SPM (Stroke Per Minute - Dakikadaki Çekiş):</label>
            <input type="number" step="0.1" id="spm" placeholder="Dakikadaki Çekiş Sayısı">
        </div>
        <div class="form-group">
            <label>Drive Süresi (saniye):</label>
            <input type="number" step="0.1" id="driveTime" placeholder="SPM girerseniz otomatik hesaplanır">
        </div>
        <div class="form-group">
            <label>Recovery Süresi (saniye):</label>
            <input type="number" step="0.1" id="recoveryTime" placeholder="SPM girerseniz otomatik hesaplanır">
        </div>
        <button id="startButton">Başlat</button>
    </div>
    <div id="phaseDetails"></div>
    <h2 id="status">Durum: Hazır</h2>

    <script>
        const startButton = document.getElementById('startButton');
        const status = document.getElementById('status');
        const phaseDetails = document.getElementById('phaseDetails');

        // Ses dosyalarını tanımlıyoruz
        const catchAndFinishSound = new Audio('./sounds/stop.mp3');
        const driveSound = new Audio('./sounds/drive.mp3');
        const recoverySound = new Audio('./sounds/recovery.mp3');

        let isRunning = false; // Döngünün çalışıp çalışmadığını kontrol eder
        let currentPhase = 0; // Şu anki fazı tutar
        let timeoutId = null; // Faz zamanlayıcısını tutar

        const stopAllSounds = () => {
            // Tüm sesleri durdur ve başa sar
            [catchAndFinishSound, driveSound, recoverySound].forEach(sound => {
                sound.pause();
                sound.currentTime = 0;
            });
        };

        const phases = [];

        const updatePhaseDetails = () => {
            phaseDetails.innerHTML = ''; // Eski bilgileri temizle
            phases.forEach((phase, index) => {
                const phaseElement = document.createElement('p');
                phaseElement.textContent = `${index + 1}. Faz: ${phase.name} - Süre: ${(phase.duration / 1000).toFixed(2)} saniye`;
                phaseDetails.appendChild(phaseElement);
            });
        };

        document.getElementById('spm').addEventListener('input', () => {
            const spm = parseFloat(document.getElementById('spm').value);

            if (spm) {
                const totalStrokeTime = (60 / spm) * 1000; // SPM'den bir stroğun toplam süresi (ms cinsinden)

                // Drive ve Recovery sürelerini eşit olarak bölüştürelim
                const driveTime = 0.5 * totalStrokeTime;
                const recoveryTime = 0.5 * totalStrokeTime;

                // Faz sürelerini input alanlarına yerleştir
                document.getElementById('driveTime').value = (driveTime / 1000).toFixed(2);
                document.getElementById('recoveryTime').value = (recoveryTime / 1000).toFixed(2);
            }
        });

        const playPhase = () => {
            if (!isRunning) return; // Çalışma durdurulduysa devam etme

            if (currentPhase >= phases.length) {
                currentPhase = 0; // Döngü başa dönsün
            }

            const phase = phases[currentPhase];
            status.textContent = `Durum: ${phase.name} (${(phase.duration / 1000).toFixed(2)}s)`;

            // Fazın sesini başlatmadan önce tüm sesleri durdur
            stopAllSounds();
            phase.sound.play().catch((error) => console.error(`${phase.name} sesi çalınamadı:`, error));

            // Mevcut faz tamamlandıktan sonra bir sonraki faza geç
            timeoutId = setTimeout(() => {
                currentPhase++;
                playPhase();
            }, phase.duration);
        };

        startButton.addEventListener('click', () => {
            if (isRunning) {
                // Metronomu durdur
                clearTimeout(timeoutId);
                stopAllSounds();
                isRunning = false;
                status.textContent = "Durum: Durduruldu";
                startButton.textContent = "Başlat";
                return;
            }

            // Metronomu başlat
            isRunning = true;
            startButton.textContent = "Durdur";

            // Faz sürelerini al ve fazları güncelle
            const catchTime = 500; // Catch süresi sabit 0.5 saniye (500 ms)
            const driveTime = parseFloat(document.getElementById('driveTime').value) * 1000;
            const finishTime = 500; // Finish süresi sabit 0.5 saniye (500 ms)
            const recoveryTime = parseFloat(document.getElementById('recoveryTime').value) * 1000;

            phases.length = 0; // Eski fazları temizle
            phases.push(
                { name: 'Catch', duration: catchTime, sound: catchAndFinishSound },
                { name: 'Drive', duration: driveTime, sound: driveSound },
                { name: 'Finish', duration: finishTime, sound: catchAndFinishSound },
                { name: 'Recovery', duration: recoveryTime, sound: recoverySound }
            );

            updatePhaseDetails(); // Faz sürelerini kullanıcıya göster

            status.textContent = 'Durum: Başlıyor...';
            currentPhase = 0; // İlk fazdan başla
            playPhase();
        });
    </script>
</body>
</html>
