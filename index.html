<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rowing Metronome</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        h1 {
            color: #2c3e50;
        }
        .form-group {
            margin: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
        #progressBarContainer {
            width: 100%;
            height: 30px;
            background-color: #f3f3f3;
            margin-top: 20px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        #progressBar {
            height: 100%;
            width: 0%;
            position: absolute;
            border-radius: 15px;
        }
        #timerAndStroke {
            font-size: 1.5em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Rowing Metronome</h1>
    <div id="settings">
        <div class="form-group">
            <label>SPM (Stroke Per Minute - Dakikadaki Çekiş):</label>
            <input type="number" step="0.1" id="spm" placeholder="Dakikadaki Çekiş Sayısı" value="21">
        </div>
        <div class="form-group">
            <label>Drive:Recovery Oranı:</label>
            <input type="text" id="ratio" placeholder="Örneğin 1:2" value="1:2">
        </div>
        <div class="form-group">
            <label>Drive Süresi (saniye):</label>
            <input type="number" step="0.1" id="driveTime" placeholder="SPM girerseniz otomatik hesaplanır">
        </div>
        <div class="form-group">
            <label>Recovery Süresi (saniye):</label>
            <input type="number" step="0.1" id="recoveryTime" placeholder="SPM girerseniz otomatik hesaplanır">
        </div>
        <button id="startButton">Başlat</button>
    </div>
    <div id="progressBarContainer">
        <div id="progressBar"></div>
    </div>
    <div id="timerAndStroke">
        <span id="lastStrokeTime">Son Stroke Süresi: 0 saniye</span><br>
        <span id="elapsedTime">Geçen Süre: 0 saniye</span> | <span id="strokeCount">Çekiş Sayısı: 0</span>
    </div>
    <h2 id="status">Durum: Hazır</h2>

    <script>
        const startButton = document.getElementById('startButton');
        const status = document.getElementById('status');
        const progressBar = document.getElementById('progressBar');
        const lastStrokeTimeDisplay = document.getElementById('lastStrokeTime');
        const elapsedTimeDisplay = document.getElementById('elapsedTime');
        const strokeCountDisplay = document.getElementById('strokeCount');

        // Ses dosyalarını tanımlıyoruz
        const catchAndFinishSound = new Audio('./sounds/stop.mp3');
        const driveSound = new Audio('./sounds/drive.mp3');
        const recoverySound = new Audio('./sounds/recovery.mp3');

        let isRunning = false; // Döngünün çalışıp çalışmadığını kontrol eder
        let currentPhase = 0; // Şu anki fazı tutar
        let timeoutId = null; // Faz zamanlayıcısını tutar
        let intervalId = null; // Zamanlayıcıyı güncellemek için
        let strokeCount = 0; // Toplam çekiş sayısını tutar
        let lastStrokeTime = 0; // En son stroke süresini tutar
        let totalElapsedTime = 0; // Başlangıçtan itibaren geçen süre

        const stopAllSounds = () => {
            // Tüm sesleri durdur ve başa sar
            [catchAndFinishSound, driveSound, recoverySound].forEach(sound => {
                sound.pause();
                sound.currentTime = 0;
            });
        };

        const phases = [];

        const updateDriveRecoveryValues = () => {
            const spm = parseFloat(document.getElementById('spm').value);
            const ratioInput = document.getElementById('ratio').value;
            if (spm && ratioInput) {
                const totalStrokeTime = (60 / spm) * 1000; // SPM'den bir stroğun toplam süresi (ms cinsinden)

                const [driveRatio, recoveryRatio] = ratioInput.split(':').map(Number);
                const totalRatio = driveRatio + recoveryRatio;

                const driveTime = (totalStrokeTime * driveRatio) / totalRatio;
                const recoveryTime = (totalStrokeTime * recoveryRatio) / totalRatio;

                document.getElementById('driveTime').value = (driveTime / 1000).toFixed(2);
                document.getElementById('recoveryTime').value = (recoveryTime / 1000).toFixed(2);
            }
        };

        document.getElementById('spm').addEventListener('input', () => {
            updateDriveRecoveryValues();
        });

        document.getElementById('ratio').addEventListener('input', () => {
            updateDriveRecoveryValues();
        });

        // Sayfa yüklendiğinde başlangıç değerlerini hesapla
        window.addEventListener('load', () => {
            updateDriveRecoveryValues();
        });

        // (Kodun geri kalanı aynı kalıyor)
    </script>
</body>
</html>
